<?xml version="1.0" encoding="UTF-8"?>
{% block content %}
{% autoescape true %}
<mods xmlns="http://www.loc.gov/mods/v3" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:mods="http://www.loc.gov/mods/v3" xsi:schemaLocation="http://www.loc.gov/mods/v3 http://www.loc.gov/standards/mods/v3/mods-3-4.xsd"> 

{% for titles in data %}

{# Article, space, optional symbol #}
{% if titles|preg_match('/^(A\\s+|An\\s+|The\\s+)(\"|\'|\\[|“|\\(|‘|\&quot\;|…)?/i') %}
<preg_matched>Article space and|or symbol</preg_matched>
{% set sort = titles|preg_split('/^(A\\s+|An\\s+|The\\s+)(\"|\'|\\[|“|\\(|‘|\&quot\;|…)?/i') %}
{% set delim = titles|split(sort[1]) %}
<nonsort>{{ delim[0]|raw }}</nonsort>
<sort>{{ sort[1] }}</sort>
{% endif %}

{# Symbol, article, any whitespace #}
{% if titles|preg_match('/^(\"|\'|\\[|“|\\(|‘|\&quot\;|…)(An\\s+|A\\s+|The\\s+)/i') %}
<preg_matched>Symbol, article, any whitespace</preg_matched>
{% set sort = titles|preg_split('/^(\"|\'|\\[|“|\\(|‘|\&quot\;|…)(An\\s+|A\\s+|The\\s+)/i') %}
{% set delim = titles|split(sort[1])%}
<nonsort>{{ delim[0]|raw }}</nonsort>
<sort>{{ sort[1] }}</sort>
{% endif %}

{# Symbol, any whitespace, article #}
{% if titles|preg_match('/^(\"|\'|\\[|“|\\(|‘|\&quot\;|…)\\s+(An\\s+|A\\s+|The\\s+)/i') %}
<preg_matched>Symbol, any whitespace, article</preg_matched>
{% set sort = titles|preg_split('/^(\"|\'|\\[|“|\\(|‘|\&quot\;|…)\\s+(An\\s+|A\\s+|The\\s+)/i') %}
{% set delim = titles|split(sort[1])%}
<nonsort>{{ delim[0]|raw }}</nonsort>
<sort>{{ sort[1] }}</sort>
{% endif %}

{# Symbol or symbol space #} 
{% if titles|preg_match('/^(\"|\'|\\[|“|\\(|‘|\&quot\;|…) ?/') %}
<preg_matched>symbol or symbol space</preg_matched>
{% set sort = titles|preg_split('/^(\"|\'|\\[|“|\\(|‘|\&quot\;|…) ?/') %}
{% set delim = titles|split(sort[1]) %}
<nonsort>{{ delim[0]|raw }}</nonsort>
<sort>{{ sort[1] }}</sort>
{% endif %}

{% endfor %}

</mods>
{% endautoescape %}
{% endblock %}